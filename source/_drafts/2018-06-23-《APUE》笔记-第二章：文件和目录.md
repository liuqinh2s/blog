---
title: 《APUE》笔记--第二章：文件和目录
tags: [操作系统]
categories: [读书笔记, 《Advance Programming in the Unix Environment》]
comments: true
---

## 文件类型

- 普通文件（regular file），包括文本文件和二进制文件。
- 目录文件（directory file），目录文件包含了其他文件的名字以及指向这些文件有关信息的指针，对一个目录文件具有读权限的任何进程都可以读该目录的内容，但只有内核才能写目录文件。
- 块特殊文件（block special file），块特殊文件提供对设备带缓冲的访问，每次访问以固定长度为单位进行。比如：磁盘。
- 字符特殊文件（character special file），字符特殊文件提供对设备不带缓冲的访问，每次访问长度可变。**系统中的所有设备，要么是字符特殊文件，要么是块特殊文件**。
- FIFO（first in first out），FIFO用于进程间通信，有时也将其称为：命名管道（named pipe）。
- 套接字（socket），用于进程间的网络通信，也可用于在一台宿主机上进程之间的非网络通信。
- 符号链接（symbolic link），符号链接指向另一个文件。

可以使用表4-1中的宏确定文件类型，m是`stat`结构体的`st_mode`成员变量，此变量存放文件类型信息，返回0表示假，返回非0表示真：

> 表4-1	<sys/stat.h>中的文件类型宏

| 宏          | 描述                   |
| ----------- | ---------------------- |
| S_ISREG(m)  | 判断是否是普通文件     |
| S_ISDIR(m)  | 判断是否是目录文件     |
| S_ISCHR(m)  | 判断是否是字符特殊文件 |
| S_ISBLK(m)  | 判断是否是块特殊文件   |
| S_ISFIFO(m) | 判断是否是FIFO         |
| S_ISLNK(m)  | 判断是否是符号链接     |
| S_ISSOCK(m) | 判断是否是套接字       |

POSIX.1允许实现将进程间通信（IPC，inter-process communication）对象（例如，消息队列和信号量等）表示为文件。表4-2中的宏可用来确定IPC对象的类型。这些宏的参数并非`st_mode`，而是指向`stat`结构体的指针。

> 表4-2	<sys/stat.h>中的IPC类型宏

| 宏               | 描述                   |
| ---------------- | ---------------------- |
| S_TYPEISMQ(buf)  | 判断是否是消息队列     |
| S_TYPEISSEM(buf) | 判断是否是信号量       |
| S_TYPEISSHM(buf) | 判断是否是共享存储对象 |

 ```
#include "apue.h"
int main(int argc, char *argv[]){
    int i;
    struct stat buf;
    char *ptr;
    for(i=1;i<argc;i++){
        prinft("%s: ",argv[i]);
        if(lstat(argv[i], &buf)<0){
            err_ret()
        }
    }
}
 ```

