---
title: Android通讯录深入研究
date: 2018-05-03
categories: [Android, 通讯录]
comments: true
---

The `DISPLAY_NAME` can be fetched either from Contacts `database/ContactsContract.Data' OR 'database/ContactsContract.CommonDataKinds.StructuredName' OR 'database/RawContactsEntity`. In the later 2 cases you will be able to fetch the `DISPLAY_NAME` using `RAW_CONTACT_ID`

Couple of Key pointers:

- Contacts._ID = Data.CONTACT_ID
- RawContacts._ID = Data.RAW_CONTACT_ID
- RawContacts.CONTACT_ID = Contacts._ID
- RawContactsEntity._ID = RawContacts._ID

Sounds confusing?? Let me try...

1. The Contacts database is divided into 3 tables `contacts`, `raw contacts`, and `data`.
2. Each table contains column (_ID) which is an auto incremented primary key.
3. data table contains all the contact info like phone number, mail id, address etc.
4. The raw contacts points to the actual contact created. Hence we use the raw contacts while adding a contact.
5. The user cannot add any data in the contacts table. The data in this table is populated internally due to aggregation of contacts.
6. The reason your logic worked for some of the contacts is: _ID for contacts, raw contacts remains same until there is any contact aggregation taking place. Lets say you add two contacts with same name abc. Here the _ID for raw contacts increments twice while _ID for contacts increments only once as these two contacts gets merged due to the aggregation of contacts

The best approach to fetch the info in your case is by using `ContactsContract.RawContactsEntity` ( an outer join of the raw_contacts table with the data table)

这里还有一篇文章，写的比较详细：http://android-contact-id-vs-raw-contact-id.blogspot.jp/

官方文档：

- https://developer.android.com/reference/android/provider/ContactsContract
- https://developer.android.com/reference/android/provider/ContactsContract.Data



