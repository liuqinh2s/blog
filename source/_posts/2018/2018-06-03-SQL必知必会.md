---
title: SQL必知必会
date: 2018-06-03
categories: [SQL]
comments: true
---

## 学数据库预备条件

首先你得 **有个数据库来作为实践操作的对象**，最好是学数据库之前能熟练使用爬虫爬取大量数据，然后将这些数据作为学习数据库的材料。

当然没有数据库也不是大问题，那你还是得随时手动准备一些数据。总之：**学数据库是需要靠动手实践的**。

## 学习途径

### 基本的SQL语法

[w3school](http://www.w3school.com.cn/sql/sql_syntax.asp)

外加随手google

## 概念大纲

- SQL，Structured Query Language，结构化查询语言，语法上大小写不敏感，语句以分号结尾，单条语句可不加分号。
- ANSI，American National Standard Instruction，美国国家标准化组织，SQL已经被ANSI标准化，虽然不同的数据库有一些自己的特性，但差异较小，我们先学好ANSI SQL即可。
- RDBMS，Relational Database Management System，关系型数据库管理系统，RDBMS是SQL的基础，RDBMS中的数据存储在表中，表由列和行组成。
- SQL可以分为两部分：DML，Data Manipulation Language，数据操作语言；DDL，Data Definition Language，数据定义语言。查询和更新构成了SQL的DML部分：`SELECT`, `UPDATE`, `DELETE`, `INSERT INTO`。SQL的DDL部分使我们有能力创建或删除表格，我们也可以定义 **索引（键）**，规定表之间的链接，以及施加表之间的约束：`CREATE DATABASE`, `ALTER DATABASE`, `CREATE TABLE`, `ALTER TABLE`, `DROP TABLE`, `CREATE INDEX`, `DROP INDEX`。

## 语法

### SELECT（查询）

SELECT 选出的结果存储在结果表中，可对结果表继续进行查询，大多数数据库系统允许使用编程函数在结果集进行导航，比如：Move-To-First-Record、Get-Record-Content、Move-To-Next-Record 等等。

#### DISTINCT（唯一）

`SELECT DISTINCT`去除重复结果

### WHERE（条件）

```sql
SELECT 列名称 FROM 表名称 WHERE 列 运算符 值
```

| 操作符  | 描述         |
| ------- | ------------ |
| =       | 等于         |
| <>      | 不等于       |
| <       | 小于         |
| >       | 大于         |
| <=      | 小于等于     |
| >=      | 大于等于     |
| BETWEEN | 在某个范围内 |
| LIKE    | 搜索某种模式 |

SQL 使用单引号来环绕 **文本值**（大部分数据库系统也接受双引号）。如果是 **数值**，请不要使用引号。

#### AND & OR

```sql
SELECT * FROM Persons WHERE (FirstName='Thomas' OR FirstName='William')
AND LastName='Carter'
```

### ORDER BY

ORDER BY 语句默认按照升序对记录进行排序。

如果您希望按照降序对记录进行排序，可以使用 DESC 关键字。

```sql
SELECT Company, OrderNumber FROM Orders ORDER BY Company DESC
```

可以按多个列来排序，也就是在第一列的基础上，在依照第二列继续排序。

```sql
SELECT Company, OrderNumber FROM Orders ORDER BY Company, OrderNumber
```

```sql
SELECT Company, OrderNumber FROM Orders ORDER BY Company DESC, OrderNumber ASC
```

### INSERT INTO

```sql
INSERT INTO table_name (列1, 列2,...) VALUES (值1, 值2,....)
```

### UPDATE

```sql
UPDATE Person SET Address = 'Zhongshan 23', City = 'Nanjing'
WHERE LastName = 'Wilson'
```

### DELETE

**DELETE 语句用于删除表中的行**。

```sql
DELETE FROM Person WHERE LastName = 'Wilson' 
```

可以删除所有行：

```sql
DELETE FROM table_name
```

或者：

```
DELETE * FROM table_name
```

这样可以清空数据，与此同时保留了表的结构。

### TOP

对于拥有数千条记录的大型表来说，TOP子句是非常有用的，它用于规定返回记录的数目（不超过限定的数）。

> 但并非所有数据库管理系统都支持TOP子句

```sql
SELECT TOP number|percent column_name(s)
FROM table_name
```

```sql
SELECT TOP 2 * FROM Persons
```

```sql
SELECT TOP 50 PERCENT * FROM Persons
```

#### MYSQL

```sql
SELECT column_name(s)
FROM table_name
LIMIT number
```

#### ORACLE

```sql
SELECT column_name(s)
FROM table_name
WHERE ROWNUM <= number
```

### LIKE

LIKE 操作符用于在 WHERE 子句中搜索列中的指定模式。"%" 可用于定义通配符（模式中缺少的字母）。

> 不区分大小写

```sql
SELECT * FROM Persons
WHERE City LIKE '%lon%'
```

| Id   | LastName | FirstName | Address       | City   |
| ---- | -------- | --------- | ------------- | ------ |
| 1    | Adams    | John      | Oxford Street | London |

### 通配符

| 通配符                     | 描述                       |
| -------------------------- | -------------------------- |
| %                          | 替代一个或多个字符         |
| _                          | 仅替代一个字符             |
| [charlist]                 | 字符列中的任意一个字符     |
| [^charlist] 或 [!charlist] | 不在字符列中的任何单一字符 |

```sql
SELECT * FROM Persons
WHERE LastName LIKE 'C_r_er'
```

```sql
SELECT * FROM Persons
WHERE City LIKE '[!ALN]%'
```

### IN

```sql
SELECT column_name(s)
FROM table_name
WHERE column_name IN (value1,value2,...)
```

